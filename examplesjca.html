<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8 from src/site/xhtml/examplesjca.xhtml at 2018-04-05
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20180405" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Mockrunner &#x2013; </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
<link rel="author" href="http://plus.google.com/111660341923910322609"/>
			<link rel="shortcut icon" href="favicon.ico" />
			<!-- Google Analytics -->
			<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36088259-3', 'mockrunner.github.io');
  ga('send', 'pageview');
			</script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><img src="images/mockrunner-header.png"  alt="Mockrunner" width="324" height="53"/></div>
</div>
        <div class="pull-right"><div id="bannerRight"><img src="images/mockrunner-tagline.png"  alt="" width="353" height="24"/></div>
</div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="index.html" title="Home">Home</a><span class="divider">/</span></li>
    <li class="active "></li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2018-04-05</li>
          <li id="projectVersion" class="pull-right"><span class="divider">|</span>Version: 2.0.1</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://oss.sonatype.org/content/groups/public/com/mockrunner" class="externalLink" title="Releases">Releases</a></li>
      <li class="pull-right"><a href="./" title="Github">Github</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Mockrunner</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="examples.html" title="Examples"><span class="icon-chevron-down"></span>Examples</a>
    <ul class="nav nav-list">
    <li><a href="examplesstruts.html" title="Struts"><span class="none"></span>Struts</a></li>
    <li><a href="examplesservlets.html" title="Servlets"><span class="none"></span>Servlets</a></li>
    <li><a href="examplestag.html" title="Tag Classes"><span class="none"></span>Tag Classes</a></li>
    <li><a href="examplesjdbc.html" title="JDBC"><span class="none"></span>JDBC</a></li>
    <li><a href="examplesejb.html" title="EJB"><span class="none"></span>EJB</a></li>
    <li><a href="examplesjms.html" title="JMS"><span class="none"></span>JMS</a></li>
    <li class="active"><a href="#"><span class="none"></span>JCA</a></li>
    </ul>
</li>
      <li class="nav-header">Modules</li>
    <li><a href="mockrunner-core/index.html" title="MockRunner-Core"><span class="none"></span>MockRunner-Core</a></li>
    <li><a href="mockrunner-jms/index.html" title="MockRunner-JMS"><span class="none"></span>MockRunner-JMS</a></li>
    <li><a href="mockrunner-ejb/index.html" title="MockRunner-EJB"><span class="none"></span>MockRunner-EJB</a></li>
    <li><a href="mockrunner-jdbc/index.html" title="MockRunner-JDBC"><span class="none"></span>MockRunner-JDBC</a></li>
    <li><a href="mockrunner-jca/index.html" title="MockRunner-JCA"><span class="none"></span>MockRunner-JCA</a></li>
    <li><a href="mockrunner-servlet/index.html" title="MockRunner-Servlet"><span class="none"></span>MockRunner-Servlet</a></li>
    <li><a href="mockrunner-tag/index.html" title="MockRunner-TAG"><span class="none"></span>MockRunner-TAG</a></li>
    <li><a href="mockrunner-struts/index.html" title="MockRunner-Struts"><span class="none"></span>MockRunner-Struts</a></li>
    <li><a href="mockrunner-all/index.html" title="MockRunner-ALL"><span class="none"></span>MockRunner-ALL</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="./" title="Powered by Github (click for project page)" class="builtBy"><img class="builtBy"  alt="Powered by Github (click for project page)" src="images/GitHub.png"    /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >



		
			
				<p>
					The JCA test framework can be used to simulate backend systems that are accessed through the use of the
					JCA Common Client Interface API. Application code that uses the Common Client Interface
					can be executed against a simulated connector. The test framework intercepts the backend
					call and provides a suitable response.
				</p>
				
<p>
					The JCA test module consists of the <i>ConnectorTestModule</i> and the corresponding
					<i>ConnectorTestCaseAdapter</i> and <i>BasicConnectorTestCaseAdapter</i>. The backend
					call is handled by an implementation of the interface <i>InteractionImplementor</i>.
					Mockrunner provides several implementations of this interface for interactions that are based on indexed
					and mapped records, on binary byte data and an implementation for applications that
					use the WSIF framework in IBM environments. It is also possible to plug in custom
					implementations.
				</p>
				
<p>
					This page provides a simple example of a DAO that calls a CICS backend. The release contains
					additional examples. The <i>PersonSearchDAO</i> contains one method <i>findPersonById</i> that
					takes an id and returns the corresponding person data as a <i>Person</i> object.
				</p>
				
<div>
<pre class="code">

public class PersonSearchDAO
{
    private ConnectionFactory connectionFactory;

    public PersonSearchDAO()
    {
        try
        {
            InitialContext context = new InitialContext();
            connectionFactory = 
               (ConnectionFactory)context.lookup(&quot;java:ra/cics/ConnectionFactory&quot;);
        } 
        catch(NamingException exc)
        {
            throw new RuntimeException(&quot;Failed to create ConnectionFactory&quot;);
        }
    }

    public Person findPersonById(String id)
    {
        Connection connection = null;
        Person request = new Person();
        request.setId(id);
        Person response = new Person();
        try
        {
            connection = connectionFactory.getConnection();
            Interaction interaction = connection.createInteraction();
            ECIInteractionSpec interactionSpec = new ECIInteractionSpec();
            interactionSpec.setFunctionName(&quot;PER3AC&quot;);
            interactionSpec.setInteractionVerb(ECIInteractionSpec.SYNC_SEND_RECEIVE);
            interactionSpec.setCommareaLength(32);
            interaction.execute(interactionSpec, request, response);
        } 
        catch(ResourceException exc)
        {
            exc.printStackTrace();
        }
        finally
        {
            try
            {
                if(null != connection) connection.close();
            } 
            catch(ResourceException exc)
            {
                exc.printStackTrace();
            }
        }
        return response;
    }
}

				</pre></div>
				
<p>
					The corresponding test uses two files <i>personin.bin</i> and <i>personout.bin</i>.
					These files are snapshots of a real mainframe communication. Once created, the snapshot
                    files can be used to simulate mainframe access in tests.
                    The <i>personin.bin</i> file represents an empty person with an id of 
                    <i>1</i>, which is the request. The <i>personout.bin</i> contains the 
                    user data for the person with id <i>1</i>. If we search for a user with id 
                    <i>1</i>, the framework recognizes that the actual request matches the expected
                   request and returns the actual response (the <i>personout.bin</i> data).
				</p>
				
<div>
<pre class="code">

public class PersonSearchDAOTest extends ConnectorTestCaseAdapter
{
    private EJBTestModule ejbModule;
    private PersonSearchDAO dao;
    
    protected void setUp() throws Exception
    {
        super.setUp();
        ejbModule = createEJBTestModule();
        ejbModule.bindToContext(&quot;java:ra/cics/ConnectionFactory&quot;, 
                      getConnectorMockObjectFactory().getMockConnectionFactory());
        dao = new PersonSearchDAO();
    }
    
    private void prepareInteraction() throws Exception
    {
        StreamableRecordByteArrayInteraction interaction = 
                                         new StreamableRecordByteArrayInteraction();
        FileInputStream request = 
           new FileInputStream(&quot;src/com/mockrunner/example/connector/personin.bin&quot;);
        FileInputStream response = 
           new FileInputStream(&quot;src/com/mockrunner/example/connector/personout.bin&quot;);
        interaction.setExpectedRequest(request);
        interaction.setResponse(response);
        getInteractionHandler().addImplementor(interaction);
        request.close();
        response.close();
    }

    public void testFindPersonById() throws Exception
    {
        prepareInteraction();
        Person response = dao.findPersonById(&quot;1&quot;);
        assertEquals(&quot;1&quot;, response.getId());
        assertEquals(&quot;Jane&quot;, response.getFirstName());
        assertEquals(&quot;Doe&quot;, response.getLastName());
        assertEquals(30, response.getAge());
        verifyConnectionClosed();
        verifyAllInteractionsClosed();
    }
}

				</pre></div>
				
<p>
					This example uses the <i>StreamableRecordByteArrayInteraction</i> which
					can always be used when the involved <i>Record</i> classes implement
					<i>Streamable</i> and if you are able to create binary snapshots of
					a real interaction. If you don't want to deal with binary data you may consider
					using <i>WSIFInteraction</i> or to provide your own implementation of
					<i>InteractionImplementor</i>.
				</p>
			
		


        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
Powered by Github.com
        </div>
      </div>
    </footer>
  </body>
</html>
