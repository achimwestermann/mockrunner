<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8 from src/site/xhtml/examplesstruts.xhtml at 2018-05-17
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20180517" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Mockrunner &#x2013; </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
<link rel="author" href="http://plus.google.com/111660341923910322609"/>
			<link rel="shortcut icon" href="favicon.ico" />
			<!-- Google Analytics -->
			<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36088259-3', 'mockrunner.github.io');
  ga('send', 'pageview');
			</script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><img src="images/mockrunner-header.png"  alt="Mockrunner" width="324" height="53"/></div>
</div>
        <div class="pull-right"><div id="bannerRight"><img src="images/mockrunner-tagline.png"  alt="" width="353" height="24"/></div>
</div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
      <li class=""><a href="index.html" title="Home">Home</a><span class="divider">/</span></li>
    <li class="active "></li>
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2018-05-17</li>
          <li id="projectVersion" class="pull-right"><span class="divider">|</span>Version: 2.0.1</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://oss.sonatype.org/content/groups/public/com/mockrunner" class="externalLink" title="Releases">Releases</a></li>
      <li class="pull-right"><a href="./" title="Github">Github</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Mockrunner</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="examples.html" title="Examples"><span class="icon-chevron-down"></span>Examples</a>
    <ul class="nav nav-list">
    <li class="active"><a href="#"><span class="none"></span>Struts</a></li>
    <li><a href="examplesservlets.html" title="Servlets"><span class="none"></span>Servlets</a></li>
    <li><a href="examplestag.html" title="Tag Classes"><span class="none"></span>Tag Classes</a></li>
    <li><a href="examplesjdbc.html" title="JDBC"><span class="none"></span>JDBC</a></li>
    <li><a href="examplesejb.html" title="EJB"><span class="none"></span>EJB</a></li>
    <li><a href="examplesjms.html" title="JMS"><span class="none"></span>JMS</a></li>
    <li><a href="examplesjca.html" title="JCA"><span class="none"></span>JCA</a></li>
    </ul>
</li>
      <li class="nav-header">Modules</li>
    <li><a href="mockrunner-core/index.html" title="MockRunner-Core"><span class="none"></span>MockRunner-Core</a></li>
    <li><a href="mockrunner-jms/index.html" title="MockRunner-JMS"><span class="none"></span>MockRunner-JMS</a></li>
    <li><a href="mockrunner-ejb/index.html" title="MockRunner-EJB"><span class="none"></span>MockRunner-EJB</a></li>
    <li><a href="mockrunner-jdbc/index.html" title="MockRunner-JDBC"><span class="none"></span>MockRunner-JDBC</a></li>
    <li><a href="mockrunner-jca/index.html" title="MockRunner-JCA"><span class="none"></span>MockRunner-JCA</a></li>
    <li><a href="mockrunner-servlet/index.html" title="MockRunner-Servlet"><span class="none"></span>MockRunner-Servlet</a></li>
    <li><a href="mockrunner-tag/index.html" title="MockRunner-TAG"><span class="none"></span>MockRunner-TAG</a></li>
    <li><a href="mockrunner-struts/index.html" title="MockRunner-Struts"><span class="none"></span>MockRunner-Struts</a></li>
    <li><a href="mockrunner-all/index.html" title="MockRunner-ALL"><span class="none"></span>MockRunner-ALL</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="./" title="Powered by Github (click for project page)" class="builtBy"><img class="builtBy"  alt="Powered by Github (click for project page)" src="images/GitHub.png"    /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >



		
			
				<p>
					This page provides a quick overview of what can be done with Mockrunner when testing 
					<a class="externalLink" href="http://struts.apache.org/">Struts</a> applications. 
					The release comes with more detailed examples. 
					They also cover mutithread action testing.
				</p>
				
<p>
					This simple action fulfils the order for some type of product.
					If there's not enough in the stock, an error is returned.
				</p>
				
<div>
<pre class="code">

public class OrderAction extends Action
{
    public ActionForward execute(ActionMapping mapping,
                                 ActionForm form,
                                 HttpServletRequest request,
                                 HttpServletResponse response) 
                                 throws Exception
    {
        OrderForm orderForm = (OrderForm)form;
        String id = orderForm.getId();
        int amount = orderForm.getAmount();
        OrderManager orderManager = 
        	OrderManager.instance(request.getSession().getServletContext());
        if(orderManager.getStock(id) &lt; amount)
        {
            ActionMessages errors = new ActionMessages();
            ActionMessage error = new ActionMessage(&quot;not.enough.in.stock&quot;, id);
            errors.add(ActionMessages.GLOBAL_MESSAGE, error);
            saveErrors(request, errors);
            return mapping.findForward(&quot;failure&quot;);
        }
        orderManager.order(id, amount);
        return mapping.findForward(&quot;success&quot;);
    }
}

				</pre></div>
				
<p>
					Now we want to write a test in case of success. Assumed
					we are working with a mock implementation of the <i>OrderManager</i>,
					the test may look like this.
				</p>
				
<div>
<pre class="code">

public class OrderActionTest extends BasicActionTestCaseAdapter
{
    private MockOrderManager orderManager;
    private OrderForm form;

    protected void setUp() throws Exception
    {
        super.setUp();
        orderManager = new MockOrderManager();
        ServletContext context = getActionMockObjectFactory().
                                                 getMockServletContext();
        context.setAttribute(OrderManager.class.getName(), orderManager);
        form = (OrderForm)createActionForm(OrderForm.class);
        setValidate(true);
    }

    public void testSuccessfulOrder()
    {
        form.setId(&quot;testProduct&quot;);
        form.setAmount(10);
        orderManager.setStock(&quot;testProduct&quot;, 20);
        actionPerform(OrderAction.class, form);
        verifyNoActionErrors();
        verifyNoActionMessages();
        verifyForward(&quot;success&quot;);
    }
}

				</pre></div>
				
<p>
					Simply extend your test class from <i>BasicActionTestCaseAdapter</i> or <i>ActionTestCaseAdapter</i> 
					instead of <a class="externalLink" href="http://www.junit.org/">JUnits</a> <i>TestCase</i>. The method names are self-explanatory.
					If you have your own base class for your tests, 
					there's also a delegator solution. It is used in the next example 
					which tests the error case.
				</p>
				
<div>
<pre class="code">

public class OrderActionTest extends MyTestCase
{
    private ActionMockObjectFactory mockFactory;
    private ActionTestModule module;
    private MockOrderManager orderManager;
    private OrderForm form;

    protected void setUp() throws Exception
    {
        super.setUp();
        orderManager = new MockOrderManager();
        mockFactory = new ActionMockObjectFactory();
        module = new ActionTestModule(mockFactory);
        ServletContext context = mockFactory.getMockServletContext();
        context.setAttribute(OrderManager.class.getName(), orderManager);
        form = (OrderForm)module.createActionForm(OrderForm.class);
        module.setValidate(true);
    }

    public void testFailureOrder()
    {
        module.addRequestParameter(&quot;id&quot;, &quot;testProduct&quot;);
        module.addRequestParameter(&quot;amount&quot;, &quot;10&quot;);
        orderManager.setStock(&quot;testProduct&quot;, 5);
        module.actionPerform(OrderAction.class, form);
        module.verifyNumberActionErrors(1);
        module.verifyActionErrorPresent(&quot;not.enough.in.stock&quot;);
        module.verifyActionErrorValue(&quot;not.enough.in.stock&quot;, &quot;testProduct&quot;);
        module.verifyNoActionMessages();
        module.verifyForward(&quot;failure&quot;);
    }
}

				</pre></div>
				
<p>
					It's nearly the same but you can extend your test from your
					base class <i>MyTestCase</i>. You have to create the <i>ActionMockObjectFactory</i>
					and the <i>ActionTestModule</i> on your own. In this test we added the
					parameters to the request instead of setting them directly.
					The framework does the necessary populating. You can use
					this mechanism just like in the real 
					<a class="externalLink" href="http://struts.apache.org/">Struts</a> environment
					or you can turn it off for special tests.
				</p>
				
<p>
					Of course there are a lot of more methods and features. Just
					download the release, read the <i>readme.txt</i> and check out the
					examples.
				</p>
			
		



        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
Powered by Github.com
        </div>
      </div>
    </footer>
  </body>
</html>
